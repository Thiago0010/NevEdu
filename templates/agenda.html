<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>NevEdu - Agenda Escolar</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f4f7f9;
    margin: 0;
    padding: 20px;
    color: #333;
  }
  h1 {
    text-align: center;
    color: #2c3e50;
  }
  #calendar {
    max-width: 720px;
    margin: 20px auto;
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 12px rgb(0 0 0 / 0.12);
    padding: 20px;
  }
  #monthYear {
    text-align: center;
    font-weight: 700;
    font-size: 1.5rem;
    margin-bottom: 10px;
    color: #2980b9;
  }
  #calendar-controls {
    text-align: center;
    margin-bottom: 20px;
  }
  #calendar-controls button {
    background-color: #2980b9;
    border: none;
    color: white;
    padding: 8px 14px;
    margin: 0 10px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 700;
    transition: background-color 0.3s ease;
  }
  #calendar-controls button:hover {
    background-color: #3498db;
  }
  #categoryFilter {
    margin: 15px auto;
    max-width: 720px;
    text-align: center;
  }
  #categoryFilter label {
    margin-right: 10px;
    font-weight: 600;
  }
  #categoryFilter select {
    padding: 5px 10px;
    font-size: 1rem;
  }
  table {
    width: 100%;
    border-collapse: collapse;
  }
  th {
    color: #2980b9;
    font-weight: 700;
    padding: 12px 0;
    border-bottom: 2px solid #2980b9;
  }
  td {
    width: 14.28%;
    border: 1px solid #ddd;
    height: 90px;
    vertical-align: top;
    padding: 6px;
    cursor: pointer;
    position: relative;
    transition: background-color 0.3s ease;
    overflow: hidden;
  }
  td:hover {
    background-color: #d6eaf8;
  }
  td.event-day {
    background-color: #eaf4fc;
  }
  .day-number {
    font-weight: 700;
    margin-bottom: 4px;
  }
  .events {
    max-height: 60px;
    overflow-y: auto;
    margin-top: 6px;
  }
  .event-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: #2980b9;
    color: white;
    margin-bottom: 4px;
    padding: 3px 6px;
    border-radius: 4px;
    font-size: 0.75rem;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .event-color {
    width: 12px;
    height: 12px;
    border-radius: 3px;
    margin-right: 6px;
    flex-shrink: 0;
  }
  .event-title {
    flex-grow: 1;
  }
  .event-actions {
    margin-left: 6px;
    cursor: pointer;
    font-weight: 700;
    color: #f44336;
  }
  .event-actions:hover {
    color: #c0392b;
  }

  /* Modal */
  #eventModal {
    display: none;
    position: fixed;
    z-index: 15;
    left: 0; top: 0; width: 100%; height: 100%;
    background-color: rgba(0,0,0,0.6);
    overflow-y: auto;
  }
  #eventModalContent {
    background-color: #fff;
    margin: 6% auto;
    padding: 25px 30px 30px;
    border-radius: 8px;
    max-width: 420px;
    box-shadow: 0 3px 15px rgb(0 0 0 / 0.25);
    position: relative;
  }
  #eventModalContent h2 {
    margin-top: 0;
    color: #2980b9;
    font-weight: 700;
    margin-bottom: 20px;
    text-align: center;
  }
  #eventModalContent label {
    display: block;
    margin: 12px 0 6px;
    font-weight: 600;
  }
  #eventModalContent input[type="text"],
  #eventModalContent textarea,
  #eventModalContent select {
    width: 100%;
    padding: 8px 10px;
    box-sizing: border-box;
    font-size: 1rem;
    border: 1.8px solid #ccc;
    border-radius: 6px;
    transition: border-color 0.3s ease;
  }
  #eventModalContent input[type="text"]:focus,
  #eventModalContent textarea:focus,
  #eventModalContent select:focus {
    border-color: #2980b9;
    outline: none;
  }
  #eventModalContent textarea {
    resize: vertical;
  }
  #eventModalContent .modal-buttons {
    margin-top: 25px;
    display: flex;
    justify-content: space-between;
  }
  #eventModalContent button {
    background-color: #2980b9;
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 6px;
    font-weight: 700;
    cursor: pointer;
    flex-grow: 1;
    margin: 0 5px;
    transition: background-color 0.3s ease;
  }
  #eventModalContent button:hover {
    background-color: #3498db;
  }
  #deleteEventBtn {
    background-color: #f44336;
  }
  #deleteEventBtn:hover {
    background-color: #c0392b;
  }
  #closeModal {
    background: none;
    border: none;
    font-size: 1.8rem;
    color: #999;
    position: absolute;
    right: 18px;
    top: 14px;
    cursor: pointer;
  }
  #closeModal:hover {
    color: #555;
  }
  /* Scrollbar evento */
  .events::-webkit-scrollbar {
    width: 6px;
  }
  .events::-webkit-scrollbar-thumb {
    background-color: #2980b9;
    border-radius: 3px;
  }
</style>
</head>
<body>

<h1>NevEdu - Agenda Escolar</h1>

<div id="calendar">
  <div id="monthYear"></div>
  <div id="calendar-controls">
    <button id="prevMonth">&lt; Mês Anterior</button>
    <button id="nextMonth">Próximo Mês &gt;</button>
  </div>
  <div id="categoryFilter">
    <label for="categorySelect">Filtrar por Categoria:</label>
    <select id="categorySelect">
      <option value="all">Todas</option>
      <option value="Matemática">Matemática</option>
      <option value="História">História</option>
      <option value="Prova">Prova</option>
      <option value="Reunião">Reunião</option>
      <option value="Outro">Outro</option>
    </select>
  </div>
  <table>
    <thead>
      <tr>
        <th>Dom</th>
        <th>Seg</th>
        <th>Ter</th>
        <th>Qua</th>
        <th>Qui</th>
        <th>Sex</th>
        <th>Sáb</th>
      </tr>
    </thead>
    <tbody id="calendarBody"></tbody>
  </table>
</div>

<!-- Modal para adicionar/editar evento -->
<div id="eventModal">
  <div id="eventModalContent">
    <button id="closeModal" title="Fechar">&times;</button>
    <h2 id="modalTitle">Adicionar Evento</h2>
    <form id="eventForm">
      <label for="eventTitle">Título do Evento:</label>
      <input type="text" id="eventTitle" required />

      <label for="eventDesc">Descrição:</label>
      <textarea id="eventDesc" rows="3"></textarea>

      <label for="eventCategory">Categoria:</label>
      <select id="eventCategory" required>
        <option value="" disabled selected>Selecione uma categoria</option>
        <option value="Matemática">Matemática</option>
        <option value="História">História</option>
        <option value="Prova">Prova</option>
        <option value="Reunião">Reunião</option>
        <option value="Outro">Outro</option>
      </select>

      <div class="modal-buttons">
        <button type="submit" id="saveEventBtn">Salvar Evento</button>
        <button type="button" id="deleteEventBtn" style="display:none;">Excluir Evento</button>
      </div>
    </form>
  </div>
</div>

<script>
  const calendarBody = document.getElementById('calendarBody');
  const monthYear = document.getElementById('monthYear');
  const prevMonthBtn = document.getElementById('prevMonth');
  const nextMonthBtn = document.getElementById('nextMonth');
  const eventModal = document.getElementById('eventModal');
  const closeModalBtn = document.getElementById('closeModal');
  const eventForm = document.getElementById('eventForm');
  const eventTitleInput = document.getElementById('eventTitle');
  const eventDescInput = document.getElementById('eventDesc');
  const eventCategorySelect = document.getElementById('eventCategory');
  const categoryFilter = document.getElementById('categorySelect');
  const deleteEventBtn = document.getElementById('deleteEventBtn');
  const modalTitle = document.getElementById('modalTitle');
  const saveEventBtn = document.getElementById('saveEventBtn');

  let currentDate = new Date();
  let selectedDay = null;
  let editingEventIndex = null;

  // Evento armazenados no localStorage (por dia string: "YYYY-MM-DD")
  // Cada evento tem { title, description, category }
  let events = JSON.parse(localStorage.getItem('neveduEvents')) || {};

  const categoryColors = {
    'Matemática': '#27ae60',
    'História': '#e67e22',
    'Prova': '#c0392b',
    'Reunião': '#2980b9',
    'Outro': '#8e44ad'
  };

  function saveEvents() {
    localStorage.setItem('neveduEvents', JSON.stringify(events));
  }

  function renderCalendar() {
    calendarBody.innerHTML = '';
    const year = currentDate.getFullYear();
    const month = currentDate.getMonth();

    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0);
    const firstWeekDay = firstDay.getDay();

    monthYear.textContent = `${firstDay.toLocaleString('pt-BR', { month: 'long' })} ${year}`;

    let dayCount = 1;
    let finished = false;

    const filterCategory = categoryFilter.value;

    for (let week = 0; week < 6; week++) {
      if (finished) break;
      let tr = document.createElement('tr');

      for (let d = 0; d < 7; d++) {
        let td = document.createElement('td');

        if (week === 0 && d < firstWeekDay) {
          td.textContent = '';
        } else if (dayCount > lastDay.getDate()) {
          td.textContent = '';
          finished = true;
        } else {
          const dayStr = `${year}-${String(month+1).padStart(2, '0')}-${String(dayCount).padStart(2, '0')}`;
          td.innerHTML = `<div class="day-number">${dayCount}</div>`;

          // Filtrar eventos por categoria
          const dayEvents = events[dayStr] ? events[dayStr].filter(ev => filterCategory === 'all' || ev.category === filterCategory) : [];

          if (dayEvents.length) {
            td.classList.add('event-day');
            const eventsDiv = document.createElement('div');
            eventsDiv.classList.add('events');

            dayEvents.forEach((ev, idx) => {
              const evDiv = document.createElement('div');
              evDiv.classList.add('event-item');
              evDiv.title = `${ev.title}\n${ev.description || ''}`;

              const colorBox = document.createElement('span');
              colorBox.classList.add('event-color');
              colorBox.style.backgroundColor = categoryColors[ev.category] || '#7f8c8d';

              const titleSpan = document.createElement('span');
              titleSpan.classList.add('event-title');
              titleSpan.textContent = ev.title;

              evDiv.appendChild(colorBox);
              evDiv.appendChild(titleSpan);

              // Botão para editar evento diretamente
              evDiv.addEventListener('click', (e) => {
                e.stopPropagation();
                openModal(dayStr, idx);
              });

              eventsDiv.appendChild(evDiv);
            });

            td.appendChild(eventsDiv);
          }

          td.addEventListener('click', () => openModal(dayStr));

          dayCount++;
        }

        tr.appendChild(td);
      }

      calendarBody.appendChild(tr);
    }
  }

  function openModal(dayStr, eventIndex = null) {
    selectedDay = dayStr;
    editingEventIndex = eventIndex;

    if (eventIndex === null) {
      modalTitle.textContent = 'Adicionar Evento';
      eventTitleInput.value = '';
      eventDescInput.value = '';
      eventCategorySelect.value = '';
      deleteEventBtn.style.display = 'none';
    } else {
      modalTitle.textContent = 'Editar Evento';
      const ev = events[dayStr][eventIndex];
      eventTitleInput.value = ev.title;
      eventDescInput.value = ev.description;
      eventCategorySelect.value = ev.category || '';
      deleteEventBtn.style.display = 'inline-block';
    }

    eventModal.style.display = 'block';
    eventTitleInput.focus();
  }

  function closeModal() {
    eventModal.style.display = 'none';
    editingEventIndex = null;
    selectedDay = null;
  }

  eventForm.addEventListener('submit', e => {
    e.preventDefault();
    if (!selectedDay) return;

    const newEvent = {
      title: eventTitleInput.value.trim(),
      description: eventDescInput.value.trim(),
      category: eventCategorySelect.value
    };

    if (!events[selectedDay]) {
      events[selectedDay] = [];
    }

    if (editingEventIndex !== null) {
      // Editar evento
      events[selectedDay][editingEventIndex] = newEvent;
    } else {
      // Adicionar evento novo
      events[selectedDay].push(newEvent);
    }

    saveEvents();
    renderCalendar();
    closeModal();
  });

  deleteEventBtn.addEventListener('click', () => {
    if (selectedDay !== null && editingEventIndex !== null) {
      events[selectedDay].splice(editingEventIndex, 1);
      if (events[selectedDay].length === 0) {
        delete events[selectedDay];
      }
      saveEvents();
      renderCalendar();
      closeModal();
    }
  });

  closeModalBtn.addEventListener('click', closeModal);
  window.addEventListener('click', e => {
    if (e.target === eventModal) {
      closeModal();
    }
  });

  prevMonthBtn.addEventListener('click', () => {
    currentDate.setMonth(currentDate.getMonth() - 1);
    renderCalendar();
  });

  nextMonthBtn.addEventListener('click', () => {
    currentDate.setMonth(currentDate.getMonth() + 1);
    renderCalendar();
  });

  categoryFilter.addEventListener('change', renderCalendar);

  renderCalendar();
</script>

</body>
</html>
